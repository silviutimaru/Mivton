<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard | Mivton - Social Platform</title>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/dashboard.css">
    <link rel="stylesheet" href="/css/admin-dashboard.css">
    <link rel="stylesheet" href="/css/components.css">
    <link rel="stylesheet" href="/css/friends-system.css">
    <!-- Multilingual chat CSS removed -->
    <link rel="stylesheet" href="/css/friend-requests.css">
    <link rel="stylesheet" href="/css/search-results.css">
    <link rel="stylesheet" href="/css/notifications.css">
    <link rel="stylesheet" href="/css/profile-modal.css">
    <link rel="stylesheet" href="/css/dropdown-fix.css">
    <link rel="stylesheet" href="/css/dashboard-language-selector.css">
    <link rel="stylesheet" href="/css/simple-chat.css">
    <link rel="stylesheet" href="/css/friend-chat.css">
    <link rel="stylesheet" href="/css/video-call.css">
    <link rel="stylesheet" href="/css/mivton-video-call.css">
    <!-- Font Awesome for video call icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
</head>
<body>
    <!-- Loading Screen -->
    <div id="loadingScreen" class="loading-screen">
        <div class="loading-content">
            <div class="loading-logo">MIVTON</div>
            <div class="loading-spinner"></div>
            <div class="loading-text">Initializing dashboard...</div>
        </div>
    </div>

    <div class="dashboard-wrapper" id="dashboardWrapper">
        <!-- Top Header with Navigation Tabs -->
        <header class="top-header">
            <div class="header-brand">
                <div class="brand-logo">
                    <h1>MIVTON</h1>
                    <span class="version">v2.1</span>
                </div>
                <div class="user-info-compact">
                    <div class="user-avatar-small" id="userAvatarSmall">?</div>
                    <div class="user-name-small" id="userNameSmall">Loading...</div>
                </div>
            </div>

            <!-- Navigation Tabs -->
            <nav class="tab-navigation">
                <a href="#" class="tab-item active" data-section="overview">
                    <div class="tab-icon">üè†</div>
                    <span>Overview</span>
                </a>
                <a href="#" class="tab-item" data-section="friends">
                    <div class="tab-icon">ü´Ç</div>
                    <span>Friends</span>
                    <div class="tab-badge" id="friendsCount">0</div>
                </a>
                <a href="#" class="tab-item" data-section="chat">
                    <div class="tab-icon">üí¨</div>
                    <span>Chat</span>
                    <div class="tab-badge notification" id="chatUnreadCount">0</div>
                </a>
                <a href="#" class="tab-item" data-section="requests">
                    <div class="tab-icon">üì®</div>
                    <span>Requests</span>
                    <div class="tab-badge notification" id="requestsCount">0</div>
                </a>
                <a href="#" class="tab-item" data-section="find">
                    <div class="tab-icon">üîç</div>
                    <span>Find Users</span>
                </a>
                <a href="#" class="tab-item" data-section="blocked">
                    <div class="tab-icon">üö´</div>
                    <span>Blocked</span>
                    <div class="tab-badge" id="blockedCount">0</div>
                </a>
                <a href="#" class="tab-item" data-section="profile">
                    <div class="tab-icon">‚öôÔ∏è</div>
                    <span>Settings</span>
                </a>
                <a href="#" class="tab-item admin-tab-item" data-section="admin" id="adminTabItem" style="display: none;">
                    <div class="tab-icon">üëë</div>
                    <span>Admin</span>
                </a>
            </nav>

            <div class="header-actions">
                <div class="notifications-btn" id="notificationsBtn">
                    <div class="bell-icon">üîî</div>
                    <div class="notification-badge" id="notificationBadge">0</div>
                </div>
                <button class="logout-btn-compact" id="logoutBtn" title="Logout">
                    <div class="logout-icon">üö™</div>
                </button>
            </div>
        </header>

        <!-- Main Content Area -->
        <main class="main-content">
            <!-- Content Sections -->
            <div class="content-container">
                <!-- Overview Section -->
                <section class="content-section active" id="overview-section">
                    <div class="welcome-banner">
                        <div class="welcome-content">
                            <h2>Welcome back, <span id="welcomeUserName">User</span>!</h2>
                            <p>Ready to connect with friends across the globe? Your social experience awaits.</p>
                        </div>
                        <div class="welcome-animation">
                            <div class="floating-emoji">üåç</div>
                            <div class="floating-emoji delay-1">üí¨</div>
                            <div class="floating-emoji delay-2">üöÄ</div>
                        </div>
                    </div>

                    <div class="dashboard-grid">
                        <div class="dashboard-card">
                            <div class="card-header">
                                <h3>Quick Stats</h3>
                                <div class="card-icon">üìä</div>
                            </div>
                            <div class="stats-grid">
                                <div class="stat">
                                    <div class="stat-number" id="statMessages">0</div>
                                    <div class="stat-label">Messages Today</div>
                                </div>
                                <div class="stat">
                                    <div class="stat-number" id="statLanguages">0</div>
                                    <div class="stat-label">Languages Used</div>
                                </div>
                                <div class="stat">
                                    <div class="stat-number" id="statFriends">0</div>
                                    <div class="stat-label">Active Friends</div>
                                </div>
                                <div class="stat">
                                    <div class="stat-number" id="statHours">0</div>
                                    <div class="stat-label">Hours Online</div>
                                </div>
                            </div>
                        </div>

                        <div class="dashboard-card">
                            <div class="card-header">
                                <h3>Recent Activity</h3>
                                <div class="card-icon">üìà</div>
                            </div>
                            <div class="activity-list" id="recentActivity">
                                <div class="activity-item">
                                    <div class="activity-icon">üéâ</div>
                                    <div class="activity-content">
                                        <div class="activity-title">Welcome to Mivton!</div>
                                        <div class="activity-time">Just now</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="dashboard-card">
                            <div class="card-header">
                                <h3>Language Preferences</h3>
                                <div class="card-icon">üåê</div>
                            </div>
                            <div class="language-info">
                                <div class="language-item">
                                    <div class="language-flag">üá∫üá∏</div>
                                    <div class="language-details">
                                        <div class="language-name" id="userLanguage">English</div>
                                        <div class="language-code">Native Language</div>
                                    </div>
                                </div>
                                <button class="change-language-btn" onclick="showSection('profile')">
                                    Change Language
                                </button>
                            </div>
                        </div>

                        <div class="dashboard-card">
                            <div class="card-header">
                                <h3>Quick Actions</h3>
                                <div class="card-icon">‚ö°</div>
                            </div>
                            <div class="quick-actions">
                                <button class="action-btn primary" onclick="showSection('find')">
                                    <div class="btn-icon">üîç</div>
                                    <span>Find Friends</span>
                                </button>
                                <button class="action-btn secondary" onclick="showSection('profile')">
                                    <div class="btn-icon">‚öôÔ∏è</div>
                                    <span>Settings</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Friends Section -->
                <section class="content-section" id="friends-section">
                    <div class="friends-container">
                        <!-- Phase 3.1 Friends Manager Component will be initialized here -->
                        <div data-component="friends-manager" id="friendsManager"></div>
                    </div>
                </section>

                <!-- Chat Section -->
                <section class="content-section" id="chat-section">
                    <div class="chat-layout">
                        <!-- Left: Conversations List -->
                        <div class="chat-conversations-container">
                            <div class="section-header">
                                <h2>Messages</h2>
                                <div class="chat-stats">
                                    <span id="conversationsCount">0 conversations</span>
                                </div>
                            </div>

                            <div class="conversations-list" id="conversationsList">
                                <div class="empty-state">
                                    <div class="empty-icon">üí¨</div>
                                    <h3>No conversations yet</h3>
                                    <p>Start chatting with your friends to see conversations here.</p>
                                    <button class="empty-action-btn" onclick="showSection('friends')">
                                        View Friends
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Right: Chat Window -->
                        <div class="chat-window-container" id="chatWindowContainer">
                            <div class="chat-placeholder">
                                <div class="placeholder-icon">üí¨</div>
                                <p>Select a conversation to start chatting</p>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Requests Section -->
                <section class="content-section" id="requests-section">
                    <div class="section-header">
                        <h2>Friend Requests</h2>
                        <div class="requests-tabs">
                            <button class="tab-btn active" data-tab="received">Received</button>
                            <button class="tab-btn" data-tab="sent">Sent</button>
                        </div>
                    </div>

                    <div class="requests-container">
                        <div class="tab-content active" id="received-requests">
                            <div class="empty-state">
                                <div class="empty-icon">üì®</div>
                                <h3>No friend requests</h3>
                                <p>You're all caught up! No pending friend requests.</p>
                            </div>
                        </div>

                        <div class="tab-content" id="sent-requests">
                            <div class="empty-state">
                                <div class="empty-icon">üì§</div>
                                <h3>No sent requests</h3>
                                <p>Start connecting by sending friend requests!</p>
                                <button class="empty-action-btn" onclick="showSection('find')">
                                    Find Friends
                                </button>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Messages Section -->
                <section class="content-section" id="messages-section">
                    <div class="messages-container">
                        <!-- Messages Manager Component will be initialized here -->
                        <div data-component="messages-manager" id="messagesManager"></div>
                    </div>
                </section>

                <!-- Find Users Section -->
                <section class="content-section" id="find-section">
                    <div class="section-header">
                        <h2>Find Friends</h2>
                        <div class="search-stats">
                            <span id="searchResultsCount">0 users found</span>
                        </div>
                    </div>

                    <div class="find-container">
                        <div class="search-box">
                            <input type="text" id="userSearchInput" placeholder="Search by username or email..." />
                            <button class="search-btn" id="searchBtn">
                                <div class="search-icon">üîç</div>
                            </button>
                        </div>

                        <div class="search-filters">
                            <select id="languageFilter">
                                <option value="">All Languages</option>
                                <!-- Enhanced language selector will populate this -->
                            </select>
                        </div>

                        <div class="search-results" id="searchResults">
                            <div class="empty-state">
                                <div class="empty-icon">üîç</div>
                                <h3>Start searching</h3>
                                <p>Use the search box above to find friends by username or email.</p>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Blocked Users Section -->
                <section class="content-section" id="blocked-section">
                    <div class="section-header">
                        <h2>Blocked Users</h2>
                        <div class="blocked-count">
                            <span id="blockedUsersCount">0 blocked users</span>
                        </div>
                    </div>

                    <div class="blocked-container">
                        <div class="empty-state" id="blockedEmptyState">
                            <div class="empty-icon">üö´</div>
                            <h3>No blocked users</h3>
                            <p>You haven't blocked anyone yet. Keeping it positive!</p>
                        </div>

                        <div class="blocked-list" id="blockedList">
                            <!-- Blocked users will be populated here -->
                        </div>
                    </div>
                </section>

                <!-- Profile & Settings Section -->
                <section class="content-section" id="profile-section">
                    <div class="section-header">
                        <h2>Profile & Settings</h2>
                        <button class="save-btn" id="saveProfileBtn">
                            <span>üíæ</span>
                            Save Changes
                        </button>
                    </div>

                    <div class="profile-container">
                        <div class="profile-card">
                            <div class="profile-header">
                                <div class="profile-avatar" id="profileAvatar">?</div>
                                <div class="profile-info">
                                    <h3 id="profileName">Loading...</h3>
                                    <div class="profile-username" id="profileUsername">@username</div>
                                    <div class="profile-joined">
                                        Member since <span id="joinedDate">2025</span>
                                    </div>
                                </div>
                            </div>

                            <div class="profile-form">
                                <div class="form-group">
                                    <label>Profile Picture</label>
                                    <div class="profile-picture-upload">
                                        <img id="profilePicturePreview" src="" alt="Profile" style="display:none; width: 120px; height: 120px; border-radius: 50%; object-fit: cover; margin-bottom: 10px;">
                                        <input type="file" id="profilePictureInput" accept="image/jpeg,image/jpg,image/png,image/gif,image/webp" style="display: none;" />
                                        <button type="button" class="btn secondary" id="uploadPictureBtn">
                                            üì∑ Upload Picture
                                        </button>
                                        <small>Max 5MB. Formats: JPG, PNG, GIF, WEBP</small>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label>Bio / About Me</label>
                                    <textarea id="bioInput" placeholder="Tell others about yourself..." maxlength="500" rows="4"></textarea>
                                    <small><span id="bioCharCount">0</span>/500 characters</small>
                                </div>

                                <div class="form-group">
                                    <label>Full Name</label>
                                    <input type="text" id="fullNameInput" placeholder="Enter your full name" />
                                </div>

                                <div class="form-group">
                                    <label>Email</label>
                                    <input type="email" id="emailInput" placeholder="Enter your email" readonly />
                                    <small>Email cannot be changed</small>
                                </div>

                                <div class="form-group">
                                    <label>Native Language</label>
                                    <select id="nativeLanguageSelect">
                                        <option value="">Select your native language...</option>
                                        <!-- Enhanced language selector will populate this -->
                                    </select>
                                </div>

                                <div class="form-group">
                                    <label>Gender</label>
                                    <select id="genderSelect" disabled readonly>
                                        <option value="">Prefer not to say</option>
                                        <option value="male">Male</option>
                                        <option value="female">Female</option>
                                        <option value="other">Other</option>
                                    </select>
                                    <small>Gender cannot be changed for legal compliance</small>
                                </div>

                                <div class="form-group">
                                    <label>Account Status</label>
                                    <div class="status-display">
                                        <div class="status-indicator online"></div>
                                        <span>Active Account</span>
                                        <div class="verified-badge" id="verifiedBadge" style="display: none;">
                                            ‚úì Verified
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="settings-card">
                            <h3>Privacy & Security</h3>
                            <div class="settings-grid">
                                <div class="setting-item">
                                    <div class="setting-info">
                                        <div class="setting-title">Profile Visibility</div>
                                        <div class="setting-description">Who can find you in search</div>
                                    </div>
                                    <select id="profileVisibility">
                                        <option value="everyone">Everyone</option>
                                        <option value="friends">Friends only</option>
                                        <option value="private">Private</option>
                                    </select>
                                </div>

                                <div class="setting-item">
                                    <div class="setting-info">
                                        <div class="setting-title">Online Status Visibility</div>
                                        <div class="setting-description">Who can see when you're online</div>
                                    </div>
                                    <select id="onlineStatusVisibility">
                                        <option value="everyone">Everyone</option>
                                        <option value="friends">Friends only</option>
                                        <option value="nobody">Nobody</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="settings-card">
                            <h3>Notification Preferences</h3>
                            <div class="settings-grid">
                                <div class="setting-item">
                                    <div class="setting-info">
                                        <div class="setting-title">Email Notifications</div>
                                        <div class="setting-description">Receive notifications via email</div>
                                    </div>
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="notifyEmail" checked />
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>

                                <div class="setting-item">
                                    <div class="setting-info">
                                        <div class="setting-title">Push Notifications</div>
                                        <div class="setting-description">Browser push notifications</div>
                                    </div>
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="notifyPush" checked />
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>

                                <div class="setting-item">
                                    <div class="setting-info">
                                        <div class="setting-title">Friend Requests</div>
                                        <div class="setting-description">Notify for new friend requests</div>
                                    </div>
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="notifyFriendRequests" checked />
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>

                                <div class="setting-item">
                                    <div class="setting-info">
                                        <div class="setting-title">Messages</div>
                                        <div class="setting-description">Notify for new messages</div>
                                    </div>
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="notifyMessages" checked />
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </main>
    </div>

    <!-- Notification Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Modal for confirmations -->
    <div class="modal" id="confirmModal">
        <div class="modal-content">
            <h3 id="modalTitle">Confirm Action</h3>
            <p id="modalMessage">Are you sure?</p>
            <div class="modal-actions">
                <button class="btn secondary" id="modalCancel">Cancel</button>
                <button class="btn primary" id="modalConfirm">Confirm</button>
            </div>
        </div>
    </div>

    <!-- Incoming Video Call Modal -->
    <div class="modal" id="incomingCallModal" style="display: none;">
        <div class="modal-content video-call-modal">
            <div class="incoming-call-content">
                <div class="caller-avatar">
                    <img id="incomingCallAvatar" src="/img/default-avatar.png" alt="Caller">
                </div>
                <h3 id="incomingCallName">Friend Name</h3>
                <p class="call-status">Incoming video call...</p>
                <div class="call-actions">
                    <button class="btn btn-danger" id="declineCallBtn">
                        <svg width="20" height="20" fill="currentColor" viewBox="0 0 16 16">
                            <path d="M3.654 1.328a.678.678 0 0 0-1.015-.063L1.605 2.3c-.483.484-.661 1.169-.45 1.77a17.568 17.568 0 0 0 4.168 6.608 17.569 17.569 0 0 0 6.608 4.168c.601.211 1.286.033 1.77-.45l1.034-1.034a.678.678 0 0 0-.063-1.015l-2.307-1.794a.678.678 0 0 0-.58-.122l-2.19.547a1.745 1.745 0 0 1-1.657-.459L5.482 8.062a1.745 1.745 0 0 1-.46-1.657l.548-2.19a.678.678 0 0 0-.122-.58L3.654 1.328zM1.884.511a1.745 1.745 0 0 1 2.612.163L6.29 2.98c.329.423.445.974.315 1.494l-.547 2.19a.678.678 0 0 0 .178.643l2.457 2.457a.678.678 0 0 0 .644.178l2.189-.547a1.745 1.745 0 0 1 1.494.315l2.306 1.794c.829.645.905 1.87.163 2.611l-1.034 1.034c-.74.74-1.846 1.065-2.877.702a18.634 18.634 0 0 1-7.01-4.42 18.634 18.634 0 0 1-4.42-7.009c-.362-1.03-.037-2.137.703-2.877L1.885.511z"/>
                            <path fill-rule="evenodd" d="M11.146 1.646a.5.5 0 0 1 .708 0L13 2.793l1.146-1.147a.5.5 0 0 1 .708.708L13.707 3.5l1.147 1.146a.5.5 0 0 1-.708.708L13 4.207l-1.146 1.147a.5.5 0 0 1-.708-.708L12.293 3.5l-1.147-1.146a.5.5 0 0 1 0-.708z"/>
                        </svg>
                        Decline
                    </button>
                    <button class="btn btn-success" id="acceptCallBtn">
                        <svg width="20" height="20" fill="currentColor" viewBox="0 0 16 16">
                            <path d="M3.654 1.328a.678.678 0 0 0-1.015-.063L1.605 2.3c-.483.484-.661 1.169-.45 1.77a17.568 17.568 0 0 0 4.168 6.608 17.569 17.569 0 0 0 6.608 4.168c.601.211 1.286.033 1.77-.45l1.034-1.034a.678.678 0 0 0-.063-1.015l-2.307-1.794a.678.678 0 0 0-.58-.122l-2.19.547a1.745 1.745 0 0 1-1.657-.459L5.482 8.062a1.745 1.745 0 0 1-.46-1.657l.548-2.19a.678.678 0 0 0-.122-.58L3.654 1.328zM1.884.511a1.745 1.745 0 0 1 2.612.163L6.29 2.98c.329.423.445.974.315 1.494l-.547 2.19a.678.678 0 0 0 .178.643l2.457 2.457a.678.678 0 0 0 .644.178l2.189-.547a1.745 1.745 0 0 1 1.494.315l2.306 1.794c.829.645.905 1.87.163 2.611l-1.034 1.034c-.74.74-1.846 1.065-2.877.702a18.634 18.634 0 0 1-7.01-4.42 18.634 18.634 0 0 1-4.42-7.009c-.362-1.03-.037-2.137.703-2.877L1.885.511z"/>
                        </svg>
                        Accept
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Video Call Interface is created dynamically by video-call-fixed.js -->

    <!-- Admin Section -->
    <section class="content-section" id="admin-section">
        <div class="admin-container">
            <div class="section-header">
                <h2>üëë Admin Dashboard</h2>
                <p>System administration and management</p>
            </div>
            
            <div class="admin-tabs">
                <button class="admin-tab active" data-tab="overview">Overview</button>
                <button class="admin-tab" data-tab="users">Users</button>
                <button class="admin-tab" data-tab="monitoring">Monitoring</button>
                <button class="admin-tab" data-tab="analytics">Analytics</button>
                <button class="admin-tab" data-tab="settings">Settings</button>
            </div>
            
            <div class="admin-content">
                <!-- Overview Tab -->
                <div class="admin-tab-content active" id="admin-overview">
                    <div class="admin-stats-grid">
                        <div class="admin-stat-card">
                            <div class="stat-icon">üë•</div>
                            <div class="stat-info">
                                <div class="stat-number">4</div>
                                <div class="stat-label">Total Users</div>
                            </div>
                        </div>
                        <div class="admin-stat-card">
                            <div class="stat-icon">üëë</div>
                            <div class="stat-info">
                                <div class="stat-number">1</div>
                                <div class="stat-label">Admin Users</div>
                            </div>
                        </div>
                        <div class="admin-stat-card">
                            <div class="stat-icon">üü¢</div>
                            <div class="stat-info">
                                <div class="stat-number">2</div>
                                <div class="stat-label">Online Users</div>
                            </div>
                        </div>
                        <div class="admin-stat-card">
                            <div class="stat-icon">üìà</div>
                            <div class="stat-info">
                                <div class="stat-number">0</div>
                                <div class="stat-label">New Today</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="admin-quick-actions">
                        <h3>Quick Actions</h3>
                        <div class="action-buttons">
                            <button class="admin-action-btn" onclick="showAdminTab('users')">
                                <span>üë•</span> Manage Users
                            </button>
                            <button class="admin-action-btn" onclick="showAdminTab('monitoring')">
                                <span>üìà</span> System Monitor
                            </button>
                            <button class="admin-action-btn" onclick="showAdminTab('analytics')">
                                <span>üìä</span> View Analytics
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Users Tab -->
                <div class="admin-tab-content" id="admin-users">
                    <div class="users-management">
                        <h3>User Management</h3>
                        <div class="users-controls">
                            <input type="text" placeholder="Search users..." class="user-search">
                            <select class="status-filter">
                                <option value="">All Status</option>
                                <option value="online">Online</option>
                                <option value="offline">Offline</option>
                            </select>
                        </div>
                        
                        <div class="users-table">
                            <table>
                                <thead>
                                    <tr>
                                        <th>User</th>
                                        <th>Email</th>
                                        <th>Status</th>
                                        <th>Role</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>
                                            <div class="user-info">
                                                <div class="user-avatar">S</div>
                                                <div class="user-details">
                                                    <div class="user-name">silviu</div>
                                                    <div class="user-fullname">Silviu Timaru</div>
                                                </div>
                                            </div>
                                        </td>
                                        <td>silviu@mivton.com</td>
                                        <td><span class="status-badge online">online</span></td>
                                        <td><span class="role-badge admin">Admin</span></td>
                                        <td>
                                            <button class="btn-sm btn-danger" onclick="alert('Block user')">Block</button>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <div class="user-info">
                                                <div class="user-avatar">T</div>
                                                <div class="user-details">
                                                    <div class="user-name">testuser1</div>
                                                    <div class="user-fullname">Test User 1</div>
                                                </div>
                                            </div>
                                        </td>
                                        <td>test1@example.com</td>
                                        <td><span class="status-badge offline">offline</span></td>
                                        <td><span class="role-badge user">User</span></td>
                                        <td>
                                            <button class="btn-sm btn-primary" onclick="alert('Promote user')">Promote</button>
                                            <button class="btn-sm btn-danger" onclick="alert('Block user')">Block</button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                <!-- Monitoring Tab -->
                <div class="admin-tab-content" id="admin-monitoring">
                    <div class="monitoring-dashboard">
                        <h3>System Monitoring</h3>
                        <div class="monitoring-grid">
                            <div class="monitoring-card">
                                <h4>System Health</h4>
                                <div class="health-status">
                                    <div class="health-indicator healthy"></div>
                                    <span>Healthy</span>
                                </div>
                                <div class="health-details">
                                    <div class="health-item">
                                        <span>Uptime:</span>
                                        <span>1h 30m</span>
                                    </div>
                                    <div class="health-item">
                                        <span>Memory:</span>
                                        <span>50 MB</span>
                                    </div>
                                </div>
                            </div>
                            <div class="monitoring-card">
                                <h4>Database</h4>
                                <div class="health-status">
                                    <div class="health-indicator healthy"></div>
                                    <span>Connected</span>
                                </div>
                                <div class="health-details">
                                    <div class="health-item">
                                        <span>Status:</span>
                                        <span>Active</span>
                                    </div>
                                    <div class="health-item">
                                        <span>Response:</span>
                                        <span>Fast</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Analytics Tab -->
                <div class="admin-tab-content" id="admin-analytics">
                    <div class="analytics-dashboard">
                        <h3>System Analytics</h3>
                        <div class="analytics-grid">
                            <div class="analytics-card">
                                <h4>User Growth</h4>
                                <div class="metric">
                                    <div class="metric-value">4</div>
                                    <div class="metric-label">Total Users</div>
                                </div>
                                <div class="metric">
                                    <div class="metric-value">0</div>
                                    <div class="metric-label">New Today</div>
                                </div>
                            </div>
                            <div class="analytics-card">
                                <h4>System Performance</h4>
                                <div class="metric">
                                    <div class="metric-value">1h 30m</div>
                                    <div class="metric-label">Uptime</div>
                                </div>
                                <div class="metric">
                                    <div class="metric-value">50 MB</div>
                                    <div class="metric-label">Memory Used</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Settings Tab -->
                <div class="admin-tab-content" id="admin-settings">
                    <div class="admin-settings">
                        <h3>Admin Settings</h3>
                        <div class="settings-grid">
                            <div class="settings-section">
                                <h4>User Management</h4>
                                <div class="setting-item">
                                    <label>Promote User to Admin</label>
                                    <div class="setting-control">
                                        <input type="text" id="promoteUsername" placeholder="Username or Email">
                                        <button class="btn btn-primary" onclick="completeAdminDashboard.promoteUser()">Promote</button>
                                    </div>
                                </div>
                                <div class="setting-item">
                                    <label>Demote Admin to User</label>
                                    <div class="setting-control">
                                        <input type="text" id="demoteUsername" placeholder="Username or Email">
                                        <button class="btn btn-warning" onclick="completeAdminDashboard.demoteUser()">Demote</button>
                                    </div>
                                </div>
                                <div class="setting-item">
                                    <label>Block User</label>
                                    <div class="setting-control">
                                        <input type="text" id="blockUsername" placeholder="Username or Email">
                                        <button class="btn btn-danger" onclick="completeAdminDashboard.blockUser()">Block</button>
                                    </div>
                                </div>
                                <div class="setting-item">
                                    <label>Unblock User</label>
                                    <div class="setting-control">
                                        <input type="text" id="unblockUsername" placeholder="Username or Email">
                                        <button class="btn btn-success" onclick="completeAdminDashboard.unblockUser()">Unblock</button>
                                    </div>
                                </div>
                                <div class="setting-item">
                                    <label>üóëÔ∏è Delete User (PERMANENT)</label>
                                    <div class="setting-control">
                                        <input type="text" id="deleteUsername" placeholder="Username or Email">
                                        <button class="btn btn-danger" onclick="completeAdminDashboard.deleteUser()" style="background-color: #dc2626; border-color: #dc2626;">Delete</button>
                                    </div>
                                    <small style="color: #ef4444; font-size: 0.8rem; margin-top: 0.5rem; display: block;">
                                        ‚ö†Ô∏è This will permanently delete the user from the entire system!
                                    </small>
                                </div>
                            </div>
                            <div class="settings-section">
                                <h4>System Maintenance</h4>
                                <div class="setting-item">
                                    <label>Database Backup</label>
                                    <div class="setting-control">
                                        <button class="btn btn-secondary" onclick="alert('Create backup')">Create Backup</button>
                                    </div>
                                </div>
                                <div class="setting-item">
                                    <label>Clear Cache</label>
                                    <div class="setting-control">
                                        <button class="btn btn-secondary" onclick="alert('Cache cleared!')">Clear Cache</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Profile Modal Container -->
    <div data-component="profile-modal" id="profileModal"></div>

    <!-- Admin Dashboard Modal -->
    <div id="adminDashboard" class="admin-dashboard-modal" style="display: none;">
        <div class="admin-overlay"></div>
        <div class="admin-panel">
            <div class="admin-header">
                <div class="admin-title">
                    <span class="admin-icon">üëë</span>
                    <h2>Admin Dashboard</h2>
                </div>
                <button class="admin-close" id="adminClose">
                    <span>√ó</span>
                </button>
            </div>
            
            <div class="admin-content">
                <div class="admin-sidebar">
                    <nav class="admin-nav">
                        <button class="admin-nav-item active" data-view="overview">
                            <span class="nav-icon">üìä</span>
                            <span class="nav-text">Overview</span>
                        </button>
                        <button class="admin-nav-item" data-view="users">
                            <span class="nav-icon">üë•</span>
                            <span class="nav-text">Users</span>
                        </button>
                        <button class="admin-nav-item" data-view="monitoring">
                            <span class="nav-icon">üìà</span>
                            <span class="nav-text">Monitoring</span>
                        </button>
                        <button class="admin-nav-item" data-view="analytics">
                            <span class="nav-icon">üìä</span>
                            <span class="nav-text">Analytics</span>
                        </button>
                        <button class="admin-nav-item" data-view="settings">
                            <span class="nav-icon">‚öôÔ∏è</span>
                            <span class="nav-text">Settings</span>
                        </button>
                    </nav>
                </div>
                
                <div class="admin-main">
                    <div class="admin-view" id="adminView">
                        <!-- Dynamic content will be loaded here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts - ENHANCED LOADING ORDER -->
    <!-- 1. Core debugging and component system FIRST -->
    <script src="/js/component-debug.js"></script>
    <script src="/js/debug-system.js"></script>
    
    <!-- 2. Socket.IO and core networking -->
    <script src="/socket.io/socket.io.js"></script>
    <!-- REMOVED socket-client.js - using enhanced-socket-client.js only -->
    <script src="/js/enhanced-socket-client.js"></script>
    
    <!-- 3. Authentication and core utilities -->
    <script src="/js/auth.js"></script>
    <script src="/js/notifications.js"></script>
    
    <!-- 4. Base component system (CRITICAL: Must load before other components) -->
    <script src="/js/mivton-base-component.js"></script>
    
    <!-- 5. Main components -->
    <script src="/js/components.js"></script>
    <script src="/js/profile-modal.js"></script>
    <script src="/js/friends-manager.js?v=20250124"></script>
    <!-- Chat JavaScript removed per user request -->
    <script src="/js/friend-requests.js"></script>
    
    <!-- 6. Language system -->
    <script src="/js/languages.js"></script>
    <script src="/js/dashboard-language-selector.js"></script>
    
    <!-- 7. Compatibility and legacy support -->
    <script src="/js/friends-compatibility.js"></script>
    
    <!-- 8. Complete functional admin dashboard -->
    <script src="/js/admin-complete.js"></script>
    
    <!-- 9. Main dashboard logic (LAST) -->
    <script src="/js/dashboard.js"></script>
    <script src="/js/simple-messaging.js"></script>
    <script src="/js/friend-chat.js"></script>
    <script src="/js/chat-language-selector.js"></script>
    <script src="/js/chat-translation-test.js"></script>
    <script src="/js/webrtc-handler.js"></script>
    <script src="/js/video-call-fixed.js?v=20250115f"></script>
    <!-- New Complete Video Call Manager -->
    <script src="/js/video-call-manager-complete.js?v=20250115g"></script>
    <!-- Video Call Integration -->
    <script src="/js/video-call-integration.js"></script>

    <!-- 9. Debug utilities (for development) -->
    <script src="/js/modal-debug.js"></script>
    <script src="/js/simple-modal-test.js"></script>
    
    
    <!-- Chat System Initialization -->
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        // Chat system removed
        
        // Initialize friends system with error handling
        try {
            const friendsContainer = document.getElementById('friendsManager');
            if (friendsContainer && window.MivtonComponents && window.MivtonComponents.FriendsManager) {
                // Friends manager will auto-initialize via data-component attribute
                console.log('‚úÖ Friends system ready for initialization');
            } else {
                console.warn('‚ö†Ô∏è Friends system components not available');
                // Fallback to basic friends display
                if (friendsContainer) {
                    friendsContainer.innerHTML = `
                        <div class="friends-fallback">
                            <div class="section-header">
                                <h2>Friends</h2>
                                <button class="add-friend-btn" onclick="showSection('find')">
                                    <span>+</span> Add Friend
                                </button>
                            </div>
                            <div class="empty-state">
                                <div class="empty-icon">ü´Ç</div>
                                <h3>Friends system loading...</h3>
                                <p>Please refresh the page if this persists.</p>
                                <button class="empty-action-btn" onclick="location.reload()">
                                    Refresh Page
                                </button>
                            </div>
                        </div>
                    `;
                }
            }
        } catch (error) {
            console.error('‚ùå Friends system initialization error:', error);
        }
        
                // Chat debugging code removed per user request
            
            // Check for any JavaScript errors
            window.addEventListener('error', function(e) {
                Debug.error('JavaScript error detected', {
                    message: e.message,
                    filename: e.filename,
                    lineno: e.lineno,
                    colno: e.colno,
                    error: e.error
                });
            });
            
        }, 3000);
        
        // Chat functions removed per user request
    </script>

    <!-- Simple Real-Time Chat Modal -->
    <div id="chatModal" class="chat-modal" style="display: none;">
        <div class="chat-container">
            <div id="chatHeader" class="chat-header">
                <div class="chat-user-info">
                    <div class="chat-user-name">Select a friend</div>
                    <div class="chat-user-status">Click on a friend to start chatting</div>
                </div>
                <button onclick="closeChat()" class="close-chat-btn">‚úï</button>
            </div>
            
            <div id="messagesContainer" class="messages-container">
                <!-- Messages appear here dynamically -->
            </div>
            
            <div class="message-input-container">
                <div id="messageError" class="message-error" style="display: none;"></div>
                <div class="message-input">
                    <input type="text" 
                           id="messageInput" 
                           placeholder="Type a message... (press Enter to send)" 
                           maxlength="1000">
                    <button onclick="sendMessage()" class="send-btn">Send</button>
                </div>
            </div>
        </div>
    </div>
                
                <!-- Chat Container (Hidden by default) -->
                <div id="chatContainer" style="display: none;">
                    <!-- Chat Header -->
                    <div class="chat-header" id="chatHeader">
                        <div class="chat-user-info">
                            <div class="chat-avatar">
                                <img src="/img/default-avatar.png" alt="User">
                                <div class="status-indicator offline"></div>
                            </div>
                            <div class="chat-user-details">
                                <h3>Select User</h3>
                                <span class="status-text">Offline</span>
                            </div>
                        </div>
                        <div class="chat-actions">
                            <button class="chat-action-btn" id="videoCallBtn" title="Start Video Call" style="display:none;">
                                <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                                    <path d="M0 5a2 2 0 0 1 2-2h7.5a2 2 0 0 1 1.983 1.738l3.11-1.382A1 1 0 0 1 16 4.269v7.462a1 1 0 0 1-1.406.913l-3.111-1.382A2 2 0 0 1 9.5 13H2a2 2 0 0 1-2-2V5z"/>
                                </svg>
                            </button>
                            <button class="chat-action-btn" id="chatInfoBtn" title="Chat Info">
                                <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                                    <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                                    <path d="m8.93 6.588-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 1.178-.252 1.465-.598l.088-.416c-.2.176-.492.246-.686.246-.275 0-.375-.193-.304-.533L8.93 6.588zM9 4.5a1 1 0 1 1-2 0 1 1 0 0 1 2 0z"/>
                                </svg>
                            </button>
                            <button class="chat-action-btn" id="closeChatAreaBtn" title="Close Chat">
                                <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                                    <path d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8 2.146 2.854Z"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Messages Container -->
                    <div class="messages-container" id="messagesContainer">
                        <!-- Messages will be loaded here -->
                    </div>
                    
                    <!-- Typing Indicator -->
                    <div class="typing-indicator" id="typingIndicator">
                        <!-- Typing status will appear here -->
                    </div>
                    
                    <!-- Message Input Area -->
                    <div class="message-input-area">
                        <div class="input-container">
                            <textarea 
                                id="messageInput" 
                                class="message-input" 
                                placeholder="Type your message..." 
                                rows="1"
                            ></textarea>
                            <div class="input-actions">
                                <button class="input-action-btn" id="emojiBtn" title="Add Emoji">
                                    <svg width="20" height="20" fill="currentColor" viewBox="0 0 16 16">
                                        <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                                        <path d="M4.285 9.567a.5.5 0 0 1 .683.183A3.498 3.498 0 0 0 8 11.5a3.498 3.498 0 0 0 3.032-1.75.5.5 0 1 1 .866.5A4.498 4.498 0 0 1 8 12.5a4.498 4.498 0 0 1-3.898-2.25.5.5 0 0 1 .183-.683zM7 6.5C7 7.328 6.552 8 6 8s-1-.672-1-1.5S5.448 5 6 5s1 .672 1 1.5zm4 0c0 .828-.448 1.5-1 1.5s-1-.672-1-1.5S9.448 5 10 5s1 .672 1 1.5z"/>
                                    </svg>
                                </button>
                                <button class="input-action-btn" id="attachBtn" title="Attach File">
                                    <svg width="20" height="20" fill="currentColor" viewBox="0 0 16 16">
                                        <path d="M4.5 3a2.5 2.5 0 0 1 5 0v9a1.5 1.5 0 0 1-3 0V5a.5.5 0 0 1 1 0v7a.5.5 0 0 0 1 0V3a1.5 1.5 0 1 0-3 0v9a2.5 2.5 0 0 0 5 0V5a.5.5 0 0 1 1 0v7a3.5 3.5 0 1 1-7 0V3z"/>
                                    </svg>
                                </button>
                                <button class="input-action-btn send-button" id="sendButton" title="Send Message">
                                    <svg width="20" height="20" fill="currentColor" viewBox="0 0 16 16">
                                        <path d="M15.854.146a.5.5 0 0 1 .11.54L13.026 8.388a.8.8 0 0 1-1.459.009L9.857 6.05 7.572 8.335a.5.5 0 0 1-.708-.708L9.35 5.141 7.003 3.432a.8.8 0 0 1 .009-1.459L14.814.035a.5.5 0 0 1 .54.111z"/>
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Old chat toggle button removed -->

    <!-- Modern Chat System Initialization -->
    <script>
        // AGGRESSIVE DEBUG: Force create chat button immediately
        console.log('üö® EMERGENCY DEBUG: Creating chat button NOW!');
        
        // Remove any existing button first
        const existingButton = document.getElementById('chatToggleBtn');
        if (existingButton) {
            existingButton.remove();
            console.log('ÔøΩ Removed existing button');
        }
        
        // Create new button with extreme styling
        const emergencyButton = document.createElement('button');
        emergencyButton.id = 'chatToggleBtn';
        emergencyButton.innerHTML = 'CHAT';
        emergencyButton.style.cssText = `
            position: fixed !important;
            top: 50% !important;
            left: 50% !important;
            width: 200px !important;
            height: 100px !important;
            background: red !important;
            color: white !important;
            font-size: 30px !important;
            border: 5px solid yellow !important;
            z-index: 999999 !important;
            cursor: pointer !important;
            display: block !important;
            visibility: visible !important;
        `;
        
        emergencyButton.onclick = function() {
            alert('CHAT BUTTON WORKS! Button is visible and clickable.');
            console.log('üö® EMERGENCY BUTTON CLICKED!');
        };
        
        document.body.appendChild(emergencyButton);
        console.log('üö® EMERGENCY CHAT BUTTON CREATED AND ADDED TO BODY');
        
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üö® DOM CONTENT LOADED - Chat button should be visible now');
            
            // Double check the button exists
            const button = document.getElementById('chatToggleBtn');
            console.log('üö® Final button check:', {
                exists: !!button,
                visible: button ? window.getComputedStyle(button).display : 'not found',
                position: button ? button.getBoundingClientRect() : 'not found'
            });
        });
            
            // Initialize Modern Chat System
            if (typeof ModernChatSystem !== 'undefined') {
                window.ModernChat = new ModernChatSystem();
                console.log('‚úÖ Modern Chat System initialized');
            } else {
                console.warn('‚ö†Ô∏è ModernChatSystem not found');
            }

            // Chat toggle functionality
            const chatToggleBtn = document.getElementById('chatToggleBtn');
            const chatModal = document.getElementById('modernChatModal');
            const closeChatBtn = document.getElementById('closeChatBtn');
            const closeChatAreaBtn = document.getElementById('closeChatAreaBtn');
            
            // Open chat modal
            if (chatToggleBtn) {
                chatToggleBtn.addEventListener('click', function() {
                    if (chatModal) {
                        chatModal.style.display = 'block';
                        document.body.style.overflow = 'hidden';
                    }
                });
            }
            
            // Close chat modal
            function closeChatModal() {
                if (chatModal) {
                    chatModal.style.display = 'none';
                    document.body.style.overflow = '';
                }
            }
            
            if (closeChatBtn) {
                closeChatBtn.addEventListener('click', closeChatModal);
            }
            
            // Chat-related event listeners removed per user request
        });

        // Chat functions completely removed per user request
    </script>
</body>
</html>